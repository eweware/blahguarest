<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta  charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<style>
 .param {}
</style>
<title>Blahgua Test App</title>
</head>

<body>
<script src="js/jquery-1.8.3.js"></script>
<script>
function rest(method, path, data, successFunction) {
 {$("#results").html("<br/>");}
           $.ajax({
            type: method,
            url: "../v2/" + path,
            data: data,
            contentType: "application/json; charset=utf-8",
            dataType: "html",
            success:  successFunction == null?defaultSuccessFunction:successFunction,
            error: function (theErr, err) {
                      $("#results").css({'color': 'red'}).html(theErr.responseText);
        }});
}
function defaultSuccessFunction(results) {
 {$("#results").css({'color': 'black'}).html(results);}
}

function createUser() {
   var username = document.getElementById("username").value;
   rest("POST", "users", '{"displayName": "'+username+'"}', setUserData);
}
function setUserData(user) {
  defaultSuccessFunction(user);
  var obj = jQuery.parseJSON(user);
alert(user);
  document.getElementById("username").value = obj.displayName;
  document.getElementById("userid").value = obj._id;
}

function getUserById() {
  var userId = document.getElementById("userid").value;
  rest("GET", "users/" + userId, setUserData);
}

function joinChannel() {
  var channelId = document.getElementById("channelid").value;
  var userId = document.getElementById("userid").value;
  alert("Joining userid="+userId+" to channel=" + channelId);
  var data = '{"userId": "' + userId + '", "groupId": "' + channelId + '"}';
  rest("POST", "userGroups", data);
}

function createBlah() {
  var userId = document.getElementById("userid").value;
  var typeId =  document.getElementById("blahtypeid").value;
  var channelId =  document.getElementById("channelid").value;
  var text =  document.getElementById("blahtext").value;
  alert(userId+" " + typeId+ " " + channelId + " " + text);
  var data = '{"authorId": "' + userId + '", "groupId": "' + channelId + '", "typeId": "' + typeId + '", "text": "' + text + '"}';
  rest("POST", "blahs", data, setBlahData);
}
function setBlahData(blahinfo) {
  defaultSuccessFunction(blahinfo);  
  var obj = jQuery.parseJSON(blahinfo);
  document.getElementById("blahid").value = obj._id;
}

function getUserBlahs() {
    var userId = document.getElementById("userid").value;
    rest("GET", "blahs?authorId=" + userId);
}

function clearResults() {
  $("#results").css({'color': 'black'}).html("<br/>");
}

function clearParameters() {
 var obj = $(".param").val("");
}

function help() {
  $("#results").css({'color': 'blue'}).html("<h4>Help</h4><div>Create User: needs a User Name</div><div>Get Users: needs no parameters</div><div>Get User By Id: needs User Id parameter -- returns users when not provided</div><div>Get User's Blahs: needs User Id parameter</div><div>Get Channels: needs no parameter</div><div>Join User To Channel: needs User Id and Channel Id parameters</div><div>Create Blah: Needs User Id parameter</div><div>Get User Blahs:: Needs User Id parameter</div><br/><div>Clear Parameters: Clears parameter values</div><div>Clear Results: clears results text</div>");
}

</script>
<h2>Actions</h2>
<div><input style="color: blue" id="help" type="button" onclick="help()" value="Help"/>
<div style="margin-top: .5em"><input id="createUser" type="button" onclick="createUser()" value="Create User"/>
&nbsp;<input id="getUsers" type="button" onclick="rest('GET', 'users', null);"  value="Get Users"/>&nbsp;
<input id="getUserById" type="button" onclick="getUserById();"  value="Get User By Id"/>&nbsp;
<input id="getUserBlahs" type="button" onclick="getUserBlahs();"  value="Get User's Blahs"/>
</div>
<div style="margin-top: .5em"><input id="getChannels" type="button" onclick="rest('GET', 'groups');"  value="Get Channels"/>&nbsp;
<input id="joinChannel" type="button" onclick="joinChannel()" value="Join User To Channel"/>&nbsp;</div>
<div style="margin-top: .5em"><input id="createBlah" type="button" onclick="createBlah()" value="Create Blah"/>&nbsp;
<input id="getUserBlahs" type="button" onclick="getUserBlahs()" value="Get User Blahs"/>&nbsp;</div>
<h2>Parameters</h2>
<input id="clearparams" type="button" onclick="clearParameters();" value="Clear Parameters"/>
<h3>User/Channel Parameters</h3>
<div>User Name: <input class="param" id="username" type="text" size=20 /></div>
<div style="margin-top: .5em">User Id: <input class="param" id="userid" type="text" size=30 /></div>
<div  style="margin-top: .5em">Channel Id: <input class="param" id="channelid" type="text" size=30 /></div>
<h3>Blah Parameters</h3>
<div>Blah Id: <input class="param" id="blahid" type="text" size=30 /></div>
<div style="margin-top: .5em">Blah Type: <select id="blahtypeid">
 <option selected="selected" value="5091c871036412176ccce82d">says</option>
 <option value="5091c871036412176ccce82e">whispers</option>
 <option value="5091c871036412176ccce82f">asks</option>
 <option value="5091c871036412176ccce830">predicts</option>
 <option value="5091c871036412176ccce831">wishes</option>
 <option value="5091c871036412176ccce832">leaks</option>
 <option value="5091c871036412176ccce833">paid</option>
</select></div>
<div style="margin-top: .5em">Blah Text:</div>
<div><textarea class="param" id="blahtext" rows="2" columns="1" value="hello">Blah text goes here</textarea></div>

<br/>
<h2>Results</h2>
<input id="clear" type="button" onclick="clearResults();" value="Clear Results"/>
<p id="results">
</p>

</body>
</html>
